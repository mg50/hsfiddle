<html>
  <head>
    <link rel="stylesheet" type="text/css" href="./css/main.css" />
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/ace/ace.js"></script>
    <script type="text/javascript" src="./js/ace/mode-haskell.js"></script>
    <script type="text/javascript" src="./js/ace/mode-html.js"></script>
    <script type="text/javascript" src="./js/ace/mode-css.js"></script>
    <script type="text/javascript" src="./js/main.js"></script>
  </head>
  <body>
    <div id="wrapper">
      <div id="nav">
        <select id="examples">
          <option value="">Examples</option>
          <option value="mousemove">jQuery mousemove</option>
          <option value="count">Counter with pre-emptive threading and channels</option>
        </select>
        <input id="submit-fiddle" type="submit">
        <div id="compiling-notification">Compiling...</div>
      </div>
      <table id="editor-table">
        <tr id="editor-headings">
          <th>code</th>
          <th>html</th>
          <th>css</th>
          <th>result</th>
        </tr>
        <tr id="editor-row">
          <td>
            <div class="editor" id="code-area"></div>
          </div>
          <td>
            <div class="editor" id="html-area"></div>
          </td>
          <td>
            <div class="editor" id="css-area"></div>
          </td>
          <td>
            <div class="editor" id="fiddle-area"></div>
          </td>
        </tr>
      </table>
    </div>

    <script type="text/ghcjs" id="mousemove">{-# LANGUAGE OverloadedStrings #-}

module Main where

import JavaScript.JQuery
import JavaScript.JQuery.Internal
import Data.Default
import qualified Data.Text as T

main = do
  b <- select "body"
  append "<div class='mouse'></div>" b
  m <- select ".mouse"
  mousemove (handler m) def b

handler :: JQuery -> Event -> IO ()
handler m e = do
  x <- pageX e
  y <- pageY e
  setText (T.pack $ show (x,y)) m
  return ()
    </script>

    <script type="text/ghcjs" id="count">{-# LANGUAGE OverloadedStrings #-}

module Main where

import JavaScript.JQuery
import JavaScript.JQuery.Internal
import Control.Monad
import Control.Concurrent
import Control.Concurrent.Chan
import qualified Data.Text as T

count :: Int -> Chan String -> IO ()
count n chan = do
  writeChan chan (show n)
  threadDelay 1000000
  count (n+1) chan

display :: JQuery -> Chan String -> IO ()
display el chan = do
  num <- readChan chan
  setText (T.pack num) el
  return ()

main = do
  chan <- newChan
  forkIO $ count 0 chan
  b <- select "body"
  append "<div></div>" b
  d <- select "div"
  forever $ display d chan
    </script>
  </body>
</html>
